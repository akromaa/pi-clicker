<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Pi Network Login</title>
  <script src="https://cdn.jsdelivr.net/npm/@pi-network/api-browser@1.3.2/build/index.min.js"></script>
</head>
<body>

<button id="login-pi">Se connecter avec Pi Network</button>

<script>
  const pi = new Pi();

  document.getElementById('login-pi').onclick = async () => {
    try {
      const userData = await pi.auth.login();
      console.log("User data from Pi:", userData);

      // Envoi du token JWT au backend Flask
      const response = await fetch('/api/verify_token', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({token: userData.token}),
      });

      const result = await response.json();
      if(result.success){
        alert(`Bonjour ${result.username} (ID: ${result.userId}), authentification réussie !`);
      } else {
        alert('Erreur d’authentification : ' + result.error);
      }
    } catch (err) {
      alert("Erreur lors de la connexion Pi : " + err.message);
      console.error(err);
    }
  };
</script>

</body>
</html>
