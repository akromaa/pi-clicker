<!DOCTYPE html>
<html>
  <head>
    <title>Pi App Example</title>
  </head>
  <body>
    <h1>Welcome to my Pi App</h1>
    <button id="sign-in-button">Sign in with Pi</button>
    <div id="user-info"></div>

    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    <script>
      const signInButton = document.getElementById('sign-in-button');
      const userInfoDiv = document.getElementById('user-info');

      signInButton.addEventListener('click', () => {
        Pi.authenticate(['username'], onIncompletePaymentFound).then(function(auth) {
          console.log(auth);
          userInfoDiv.innerText = `Hello ${auth.user.username}`;
          // Send auth.token to your server to create payment
          fetch('/create_payment', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              username: auth.user.username,
              accessToken: auth.accessToken
            })
          })
          .then(response => response.json())
          .then(data => {
            console.log('Payment created', data);
          });
        }).catch(function(error) {
          console.error(error);
        });
      });

      function onIncompletePaymentFound(payment) {
        console.log("Incomplete payment found", payment);
      }
    </script>
  </body>
</html>
